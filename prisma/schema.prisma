datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model Tournament {
  id                 String     @id @default(uuid())
  name               String
  currentLeaderId    String?
  currentLeader      Couple?    @relation("CurrentLeader", fields: [currentLeaderId], references: [id])
  currentMatchNumber Int
  numberOfCourts     Int
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
  couples            Couple[]
  matches            Match[]
  winners            Couple[]   @relation("TournamentWinners")
  scoresJson         Json?
}

model Couple {
  id               String      @id @default(uuid())
  tournamentId     String
  tournament       Tournament  @relation(fields: [tournamentId], references: [id])
  player1Id        String
  player2Id        String
  player1          Player      @relation("Player1Couple", fields: [player1Id], references: [id])
  player2          Player      @relation("Player2Couple", fields: [player2Id], references: [id])
  matchesAsCouple1 Match[]     @relation("couple1Matches")
  matchesAsCouple2 Match[]     @relation("couple2Matches")
  tournamentsWon   Tournament[] @relation("TournamentWinners")
  currentLeaderIn  Tournament[] @relation("CurrentLeader")
}

model Match {
  id           String     @id @default(uuid())
  tournamentId String
  tournament   Tournament @relation(fields: [tournamentId], references: [id])
  couple1Id    String
  couple2Id    String
  couple1      Couple     @relation("couple1Matches", fields: [couple1Id], references: [id])
  couple2      Couple     @relation("couple2Matches", fields: [couple2Id], references: [id])
  couple1Score Int?
  couple2Score Int?
}

enum Gender {
  Varonil
  Femenil
  Indefinido
}

enum Level {
  Quinta
  Cuarta
  Tercera
  Segunda
  Primera
}

model Player {
  id               String   @id @default(uuid())
  name             String
  email            String? 
  age              Int?
  phone            String?
  gender           Gender  @default(Indefinido)
  level            Level   @default(Quinta)
  couplesAsPlayer1 Couple[] @relation("Player1Couple")
  couplesAsPlayer2 Couple[] @relation("Player2Couple")
}
